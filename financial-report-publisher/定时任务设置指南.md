# Windows 定时任务设置指南

## 方法1：使用任务计划程序（图形界面）

1. **打开任务计划程序**
   - 按 Win + R
   - 输入 `taskschd.msc`
   - 回车

2. **创建基本任务**
   - 点击右侧"创建基本任务"
   - 名称：金融行情简报发布
   - 描述：每天15:30自动发布行情简报

3. **设置触发器**
   - 选择"每天"
   - 开始时间：15:30:00
   - 每隔：1天

4. **设置操作**
   - 选择"启动程序"
   - 程序或脚本：`D:\Program Files\Python310\python.exe`
   - 添加参数：`E:\jieyue_data\financial-report-publisher\scripts\market_report_publisher.py`
   - 起始于：`E:\jieyue_data\financial-report-publisher\scripts`

5. **完成设置**
   - 勾选"当单击完成时，打开此任务属性的对话框"
   - 在"常规"选项卡，勾选"使用最高权限运行"

## 方法2：使用PowerShell脚本

保存以下内容为 `create_task.ps1`：

```powershell
$action = New-ScheduledTaskAction -Execute "D:\Program Files\Python310\python.exe" `
    -Argument "E:\jieyue_data\financial-report-publisher\scripts\market_report_publisher.py" `
    -WorkingDirectory "E:\jieyue_data\financial-report-publisher\scripts"

$trigger = New-ScheduledTaskTrigger -Daily -At 3:30PM

$principal = New-ScheduledTaskPrincipal -UserId "$env:USERNAME" -RunLevel Highest

Register-ScheduledTask -TaskName "金融行情简报发布" `
    -Action $action `
    -Trigger $trigger `
    -Principal $principal `
    -Description "每天15:30自动发布金融行情简报到微信公众号"

Write-Host "定时任务创建成功！" -ForegroundColor Green
```

运行：
```powershell
powershell -ExecutionPolicy Bypass -File create_task.ps1
```

## 方法3：使用schtasks命令

```cmd
schtasks /create /tn "金融行情简报发布" /tr "\"D:\Program Files\Python310\python.exe\" \"E:\jieyue_data\financial-report-publisher\scripts\market_report_publisher.py\"" /sc daily /st 15:30 /rl highest
```

## 验证定时任务

查看任务列表：
```cmd
schtasks /query /tn "金融行情简报发布"
```

立即运行测试：
```cmd
schtasks /run /tn "金融行情简报发布"
```

删除任务：
```cmd
schtasks /delete /tn "金融行情简报发布" /f
```

## 注意事项

1. **Python路径** - 确保Python路径正确
2. **工作目录** - 设置正确的工作目录，确保能找到config.json
3. **权限** - 使用"最高权限运行"避免权限问题
4. **日志** - 建议添加日志记录，方便排查问题

## 添加日志记录

修改批处理文件：
```batch
@echo off
set LOG_FILE=E:\jieyue_data\logs\report_%date:~0,4%%date:~5,2%%date:~8,2%.log
echo [%date% %time%] 开始执行 >> %LOG_FILE%
"D:\Program Files\Python310\python.exe" "E:\jieyue_data\financial-report-publisher\scripts\market_report_publisher.py" >> %LOG_FILE% 2>&1
echo [%date% %time%] 执行完成 >> %LOG_FILE%
```
